const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["shared/Navbar-chunk-Bmq4wKz-.js","shared/index-chunk-CEXPDuLj.js","shared/index-DnVUw_vK.css","shared/hooks-chunk-DtK45pyX.js","shared/redirect-chunk-DBXMV5M2.js","shared/Alert-chunk-7KL-PA51.js","shared/Fade-chunk-BUf0lCBf.js","shared/divWithClassName-chunk-CAIrAdFE.js","shared/CloseButton-chunk-481vGlg4.js","shared/AbstractModalHeader-chunk-Z9zsovdD.js","shared/hasClass-chunk-CnlNRzFA.js","shared/warning-chunk-C3XMKpUZ.js","shared/CardHeaderContext-chunk-DUDyEd_j.js","shared/InputGroupContext-chunk-DiYP6hY5.js","shared/Navbar-DjE7EqfI.css","shared/Footer-chunk-B0nAH3Vv.js","shared/html.parse-chunk-DPn1M0Cf.js","shared/Footer-IHQMiBN9.css"])))=>i.map(i=>d[i]);
import{m as de,a as me,b as ue,r,u as W,j as e,c as H,d as he,e as pe,f as R,P as K,F as S,g as xe,C as ge,B as A,h as je,i as be,k as fe,_ as Q,o as ve,L as ye,l as we,n as Ne,p as Se,q as ke,V as $e,s as Ie}from"../shared/index-chunk-CEXPDuLj.js";import{A as Te,a as Ee,b as _e}from"../shared/authenticatedRoot.store-chunk-ElWfD4ZO.js";/* empty css                *//* empty css                             */import{s as Ce}from"../shared/html.parse-chunk-DPn1M0Cf.js";import{O as X,T as Y,f as B,L as Pe,a as Re}from"../shared/format-chunk-Dp-GLVmU.js";import{F as G,a as Ae,b as Le}from"../shared/Form-chunk-MwMlHtPH.js";import{c as Me}from"../shared/InputGroupContext-chunk-DiYP6hY5.js";import"../shared/hasClass-chunk-CnlNRzFA.js";import"../shared/Fade-chunk-BUf0lCBf.js";import"../shared/warning-chunk-C3XMKpUZ.js";const k=r.forwardRef(({className:s,bsPrefix:t,as:o="span",...g},p)=>(t=W(t,"input-group-text"),e.jsx(o,{ref:p,className:H(s,t),...g})));k.displayName="InputGroupText";const Z=r.forwardRef(({bsPrefix:s,size:t,hasValidation:o,className:g,as:p="div",...v},m)=>{s=W(s,"input-group");const j=r.useMemo(()=>({}),[]);return e.jsx(Me.Provider,{value:j,children:e.jsx(p,{ref:m,...v,className:H(g,s,t&&`${s}-${t}`,o&&"has-validation")})})});Z.displayName="InputGroup";const ze=Object.assign(Z,{Text:k,Radio:s=>e.jsx(k,{children:e.jsx(G,{type:"radio",...s})}),Checkbox:s=>e.jsx(k,{children:e.jsx(G,{type:"checkbox",...s})})}),J=({avatar:s,bundle:t})=>s?e.jsx(X,{overlay:e.jsx(Y,{children:t==null?void 0:t[s.name]}),children:e.jsx("img",{src:`${K}${s.path}`,alt:`${s.type}-${s.name}`,className:"avatar"})}):null,Oe=()=>e.jsxs("div",{className:"chat-typing-container",children:[e.jsx("span",{className:"dot"}),e.jsx("span",{className:"dot"}),e.jsx("span",{className:"dot"})]}),Ve=({time:s,bundle:t})=>{const o={container:{position:"relative",display:"inline-block",width:"24px",height:"24px"},icon:{fontSize:"24px",color:"#3498db"},text:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"8px",fontWeight:"bold",color:"white"}};return e.jsx(X,{overlay:e.jsx(Y,{children:t==null?void 0:t["page.visitor.timeToProcess"]}),children:e.jsxs("div",{style:o.container,children:[e.jsx(S,{icon:xe,style:o.icon}),e.jsx("span",{style:o.text,children:s})]})})},Ue=()=>{const{uiStore:{bundle:s,pathNavigation:t,locale:o},authStore:g}=D(),[p,v]=r.useState(""),[m,j]=r.useState(null),{chatInteractions:$,sendMessage:ee,isLoading:I}=((a,i)=>{const[c,x]=r.useState([]),[ne,E]=r.useState(!1),[ie,_]=r.useState(null),U=r.useCallback(async b=>{for(let l=0;l<i;l++)try{return await fetch(b,{method:"GET",headers:{[pe]:he}})}catch(d){if(console.error(`Attempt ${l+1} failed: ${d.message}`),l===i-1)throw d;await new Promise(u=>setTimeout(u,1e3))}throw new Error("Retry limit reached")},[i]),F=r.useCallback(async b=>{const l=new TextDecoder("utf-8");let d="";try{for(;;){const{done:u,value:oe}=await b.read();if(u)break;d+=l.decode(oe,{stream:!0});const q=d.split(`

`);d=q.pop()||"";for(const N of q)if(N.startsWith("data:")){const ce=N.substring(5);try{const h=JSON.parse(ce);h.answer=Ce(h.answer),x(le=>{const f=[...le],C=f.length,P=f[C-1];return C>0&&P.id===h.id?f[C-1]={...P,answer:P.answer+h.answer,timeToProcess:h.timeToProcess}:f.push(h),f})}catch(h){console.error("Error parsing JSON:",h)}}else N.trim()!==""&&console.warn(`Unexpected event format: ${N}`)}}catch(u){console.error("Error processing stream:",u),_(u)}finally{E(!1)}},[x]);return{chatInteractions:c,sendMessage:r.useCallback(async b=>{if(a){E(!0),_(null);try{const l=encodeURIComponent(b),d=await U(`${a}?prompt=${l}`);if(!d.body)throw new Error("Response body is null");const u=d.body.getReader();await F(u)}catch(l){_(l),E(!1)}}},[a,U,F]),isLoading:ne,error:ie}})(t==null?void 0:t.chat,3),[se,ae]=r.useState(null),[te,re]=r.useState(null),y=r.useRef(null),[L,w]=r.useState(null),[T,M]=r.useState(!1);r.useEffect(()=>{(async a=>{if(a)return(await R.get(a)).data})(t==null?void 0:t.currentConversation).then(a=>{if(a){j(a);const i=setTimeout(z,500);return()=>clearTimeout(i)}}),(async a=>{if(a)return(await R.get(K+a)).data})(t==null?void 0:t.avatarIcons).then(a=>{a&&(re(O(a,"Bot")),ae(O(a,"User")))})},[]);const z=()=>{y.current&&"scrollIntoView"in y.current&&y.current.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{j(a=>{const i=a!=null&&a.chatInteractions?a.chatInteractions.filter(c=>!$.some(x=>x.id===c.id)):[];return{startedAt:(a==null?void 0:a.startedAt)??null,status:(a==null?void 0:a.status)??"not_yet_completed",chatInteractions:[...i,...$]}}),z()},[$]);const O=(a,i)=>{const c=a.filter(x=>x.type===i);return c[Math.floor(Math.random()*c.length)]},V=a=>{M(!0),(async(i,c)=>{if(i)return(await R.post(`${i}?res=${c}`)).data})(t==null?void 0:t.chatFeedback,a).then(i=>{i&&j(c=>c?{...c,status:i}:null)})},n=m==null?void 0:m.chatInteractions;return e.jsxs(ge,{className:"base-container container-xl",children:[(n==null?void 0:n.length)==0&&!I&&e.jsxs("div",{className:"chat-content",children:[e.jsx("p",{className:"chat-greeting",children:s==null?void 0:s["page.visitor.greeting"].replace("{0}",g.getUserName())}),e.jsx("p",{className:"chat-tip",children:s==null?void 0:s["page.visitor.tip"]})]}),e.jsxs("div",{id:"chat-messages",className:"chat-messages-container",children:[n==null?void 0:n.map(a=>e.jsxs("div",{className:"mb-3 message-container",children:[e.jsxs("div",{className:"user-message-wrapper",children:[e.jsxs("div",{className:"user-message",id:`user-message-${a.id}`,onMouseEnter:()=>w(`user-message-${a.id}`),onMouseLeave:()=>w(null),children:[a.question,L===`user-message-${a.id}`&&e.jsxs("div",{className:"chat-message-md",children:[s==null?void 0:s["page.visitor.askedAt"]," ",B(a.askedAt,o||"en-US")]})]}),e.jsx(J,{avatar:se,bundle:s})]}),e.jsxs("div",{className:"bot-message-wrapper",ref:(n==null?void 0:n.indexOf(a))===(n==null?void 0:n.length)-1?y:null,children:[e.jsx(J,{avatar:te,bundle:s}),e.jsxs("div",{className:"bot-message",id:`bot-answer-${a.id}`,onMouseEnter:()=>w(`bot-answer-${a.id}`),onMouseLeave:()=>w(null),children:[a.answer,L===`bot-answer-${a.id}`&&e.jsxs("div",{className:"chat-message-md",children:[e.jsx(Pe,{language:a.questionLanguage,width:14,style:{verticalAlign:"baseline"}})," ",s==null?void 0:s["page.visitor.answeredAt"]," ",B(a.askedAt+a.timeToProcess,o||"en-US"),e.jsx("br",{}),e.jsx(Ve,{time:Re(a.timeToProcess),bundle:s})]})]})]})]},a.id)),I&&e.jsx("div",{className:"mb-3",children:e.jsx(Oe,{})}),(n==null?void 0:n.length)!==0&&!I&&!T&&(m==null?void 0:m.status)!=="completed_explicitly"&&e.jsx("div",{className:"message-feedback-wrapper",children:e.jsxs("div",{className:"message-feedback mb-3",children:[e.jsx("h6",{children:s==null?void 0:s["page.visitor.feedback"]}),e.jsxs("div",{className:"message-feedback-btns mt-2",children:[e.jsxs(A,{variant:"success",type:"submit",size:"sm",disabled:T,onClick:()=>V(0),children:[e.jsx(S,{icon:je})," ",s==null?void 0:s["page.visitor.feedback.positive"]]}),e.jsxs(A,{variant:"danger",type:"submit",size:"sm",disabled:T,onClick:()=>V(1),children:[e.jsx(S,{icon:be})," ",s==null?void 0:s["page.visitor.feedback.negative"]]})]})]})})]}),e.jsx(Ae,{onSubmit:a=>{a.preventDefault(),M(!1),ee(p),v("")},className:"chat-form",children:e.jsxs(ze,{children:[e.jsx(Le,{type:"text",placeholder:s==null?void 0:s["page.visitor.type"],value:p,onChange:a=>{v(a.target.value)},className:"chat-input"}),e.jsx(A,{variant:"primary",disabled:!p,type:"submit",className:"chat-send-button",children:e.jsx(S,{icon:fe})})]})})]})},Fe=r.lazy(()=>Q(()=>import("../shared/Navbar-chunk-Bmq4wKz-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),qe=r.lazy(()=>Q(()=>import("../shared/Footer-chunk-B0nAH3Vv.js"),__vite__mapDeps([15,1,2,16,17]))),Be=ve(function(){const s=D(),{uiStore:t,authStore:o}=s;return e.jsx(e.Fragment,{children:s.loading?e.jsx(ye,{}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{uiStore:t,authStore:o}),e.jsx(Ue,{}),e.jsx(qe,{uiStore:t})]})})}),{useStoreContext:D,StoreContext:Ge}=we(),Je=ke(Ge),We=new class extends Te{constructor(s){super(new Ee(null)),de(this,{...ue,..._e,init:me}),this.initThis(s)}}(()=>Ne(Ie,$e));Se.createRoot(document.getElementById("root")).render(e.jsx(r.StrictMode,{children:e.jsx(Je,{rootStore:We,children:e.jsx(Be,{})})}));
